<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Parsing summary • rprime</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Parsing summary">
<meta property="og:description" content="rprime">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rprime</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/multiple-files.html">Working with multiple files</a>
    </li>
    <li>
      <a href="../articles/parsing-summary.html">Parsing summary</a>
    </li>
    <li>
      <a href="../articles/quick-start-demo.html">Quick start demonstration</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/tjmahr/rprime/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Parsing summary</h1>
                        <h4 class="author">Tristan Mahr</h4>
            
            <h4 class="date">2020-09-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/tjmahr/rprime/blob/master/vignettes/parsing-summary.Rmd"><code>vignettes/parsing-summary.Rmd</code></a></small>
      <div class="hidden name"><code>parsing-summary.Rmd</code></div>

    </div>

    
    
<p>Eprime, or more officially E-Prime® 2.0, is a set of programs by <a href="https://www.pstnet.com/">Psychology Software Tools, Inc.</a> used for running psychological experiments. Data from experiment sessions are saved into two files: 1) a proprietary <a href="https://support.pstnet.com/hc/en-us/articles/229354727">binary <code>.edat2</code> file</a>, and 2) a plain-text <code>.txt</code> file. The rprime package provides a set of functions for parsing these <code>.txt</code> files inside R.</p>
<p>This vignette documents how rprime parses an Eprime text file and the changes it makes during that process. <strong>See the quick-start vignette for examples of how to use this package.</strong></p>
<p><strong>Disclaimer</strong>: I write this documentation as someone who has spent little time creating and designing experiments in Eprime but has spent a lot of time parsing Eprime text files in R. Therefore, this vignette is not documentation for Eprime software or its data format. Instead, this vignette just outlines this package’s approach to extracting data from Eprime text files.</p>
<div id="background" class="section level2">
<h2 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h2>
<p>An Eprime <code>txt</code> file is a series of <strong>frames</strong>. Each frame is a list of key-value pairs. Frames are bracketed by special start and stop lines.</p>
<p>Each file begins with a special <strong>Header</strong> frame. The header is set off by the brackets <code>*** Header Start***</code> and <code>*** Header End***</code>. The fields in the header describe the basic settings of the experiment. A header frame looks like something this (the several-hundred character-long <code>Clock.Information</code> line has been omitted):</p>
<pre><code>*** Header Start ***
VersionPersist: 1
LevelName: Session
LevelName: Block
LevelName: Trial
LevelName: SubTrial
LevelName: LogLevel5
LevelName: LogLevel6
LevelName: LogLevel7
LevelName: LogLevel8
LevelName: LogLevel9
LevelName: LogLevel10
Experiment: SAE_MinimalPairDiscrim
SessionDate: 07-10-2013
SessionTime: 10:46:22
SessionTimeUtc: 3:46:22 PM
Dialect: Yes
Subject: 001
ExpTyp: L
Age: 00
Gender: X
Session: 1
RandomSeed: -261296366
Group: 1
Display.RefreshRate: 60.003
*** Header End ***</code></pre>
<p>The other frames in the text file are <strong>LogFrames</strong>. These record data about the individual procedures or trials are executed during the experiment. The following lines immediately follow the header from the previous example:</p>
<pre><code>    Level: 2
    *** LogFrame Start ***
    Procedure: FamTask
    item1: bear
    item2: chair
    CorrectResponse: bear
    ImageSide: Left
    Duration: 885
    Familiarization: 1
    FamInforcer: 1
    ReinforcerImage: Bicycle1
    Familiarization.Cycle: 1
    Familiarization.Sample: 1
    Running: Familiarization
    FamTarget.RESP:
    Correct: True
    *** LogFrame End ***</code></pre>
<p>Trials and procedures can be <strong>nested</strong> inside of higher-order sections of the experiment. For example, practice trials may be nested inside of a practice block of an experiment. The level of nesting in the above frame is indicated by the number of tabs before each line as well as the <code>Level</code> line. The only Level 1 frames in an experiment appear to the header frame and the final frame of an experiment (which largely duplicates the header frame).</p>
<p>Some <strong>special fields</strong> appear in every log-frame. These fields are <code>Procedure</code>, <code>Running</code>, <code>[Running].Sample</code>, <code>[Running].Cycle</code> and <code>[Running]</code> where <code>[Running]</code> is the value of the running field. In the previous example, these were:</p>
<pre><code>    Procedure: FamTask
    Familiarization.Cycle: 1
    Familiarization.Sample: 1
    Running: Familiarization
    Familiarization: 1</code></pre>
<p>When trials are presented in a random order, the <code>[Running].Sample</code> field records the sequential trial number.</p>
</div>
<div id="strategy" class="section level2">
<h2 class="hasAnchor">
<a href="#strategy" class="anchor"></a>Strategy</h2>
<p>The basic strategy for parsing the Eprime file:</p>
<ol style="list-style-type: decimal">
<li>Read in the Eprime file.</li>
<li>Create <code>EprimeFrame</code> objects.
<ol style="list-style-type: lower-alpha">
<li>Extract the frames.</li>
<li>Create key-value pairs inside the frame by splitting text lines at <code><a href="https://rdrr.io/r/base/Colon.html">:</a></code> characters.</li>
<li>Add some helpful metadata inside each frame.</li>
<li>Bundle up the key-value pairs into an R <code>list</code> object with an added <code>EprimeFrame</code> class.</li>
</ol>
</li>
<li>Bundle the frames from an experiment together inside of a <code>FrameList</code> object.</li>
</ol>
<p>Each of these steps is handled by some lower level functions. <strong>In practice, only two high-level functions are necessary to transform from a text file to a list of <code>Eprime.Frame objects</code>: <code>read_eprime</code> and <code>FrameList</code>.</strong> Here’s how these two functions can be used to get us the header frame from a text file.</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st"><a href="https://github.com/tjmahr/rprime">"rprime"</a></span>)
<span class="kw">eprime_lists</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FrameList.html">FrameList</a></span>(<span class="fu"><a href="../reference/read_eprime.html">read_eprime</a></span>(<span class="st">"data/MINP_001L00XS1.txt"</span>))
<span class="kw">eprime_lists</span>[[<span class="fl">1</span>]]
<span class="co">#&gt; List of 21</span>
<span class="co">#&gt;  $ Eprime.Level       : num 1</span>
<span class="co">#&gt;  $ Eprime.LevelName   : chr "Header_"</span>
<span class="co">#&gt;  $ Eprime.Basename    : chr "MINP_001L00XS1"</span>
<span class="co">#&gt;  $ Eprime.FrameNumber : chr "1"</span>
<span class="co">#&gt;  $ Procedure          : chr "Header"</span>
<span class="co">#&gt;  $ Running            : chr "Header"</span>
<span class="co">#&gt;  $ VersionPersist     : chr "1"</span>
<span class="co">#&gt;  $ LevelName          : chr "LogLevel10"</span>
<span class="co">#&gt;  $ Experiment         : chr "SAE_MinimalPairDiscrim"</span>
<span class="co">#&gt;  $ SessionDate        : chr "07-10-2013"</span>
<span class="co">#&gt;  $ SessionTime        : chr "10:46:22"</span>
<span class="co">#&gt;  $ SessionTimeUtc     : chr "3:46:22 PM"</span>
<span class="co">#&gt;  $ Dialect            : chr "Yes"</span>
<span class="co">#&gt;  $ Subject            : chr "001"</span>
<span class="co">#&gt;  $ ExpTyp             : chr "L"</span>
<span class="co">#&gt;  $ Age                : chr "00"</span>
<span class="co">#&gt;  $ Gender             : chr "X"</span>
<span class="co">#&gt;  $ Session            : chr "1"</span>
<span class="co">#&gt;  $ RandomSeed         : chr "-261296366"</span>
<span class="co">#&gt;  $ Group              : chr "1"</span>
<span class="co">#&gt;  $ Display.RefreshRate: chr "60.003"</span>
<span class="co">#&gt;  - attr(*, "class")= chr [1:2] "EprimeFrame" "list"</span>
</pre></div>
<div id="file-reading" class="section level3">
<h3 class="hasAnchor">
<a href="#file-reading" class="anchor"></a>File reading</h3>
<p>Lines from the text file are read into R and stored into a character vector. Here are the first few lines from the example file:</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw">exp_lines</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_eprime.html">read_eprime</a></span>(<span class="st">"data/MINP_001L00XS1.txt"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">exp_lines</span>)
<span class="co">#&gt; [1] "*** Header Start ***" "VersionPersist: 1"    "LevelName: Session"  </span>
<span class="co">#&gt; [4] "LevelName: Block"     "LevelName: Trial"     "LevelName: SubTrial"</span>
</pre></div>
<p>Some things to note about file reading. By default, the enormous <code>Clock.Information</code> lines are omitted. Also, if the file is not an Eprime <code>.txt</code> file, a <strong>dummy header</strong> is created so that the file may be treated like any other like Eprime. The user is warned as this happens.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="kw">bad_lines</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_eprime.html">read_eprime</a></span>(<span class="st">"data/not_an_eprime_file.txt"</span>)
<span class="co">#&gt; Warning in read_eprime("data/not_an_eprime_file.txt"): data/</span>
<span class="co">#&gt; not_an_eprime_file.txt is not an Eprime txt file. Dummy text will be used</span>
<span class="co">#&gt; instead.</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">bad_lines</span>)
<span class="co">#&gt; [1] "*** Header Start ***" "*** Header End ***"</span>
</pre></div>
<p>I chose to use a dummy header instead of raising an error so that code which loads multiple files at once will not fail outright when it encounters a bad file.</p>
</div>
<div id="chunking" class="section level3">
<h3 class="hasAnchor">
<a href="#chunking" class="anchor"></a>Chunking</h3>
<p>The next step in parsing the file is to extract all the frames. This is accomplished by pulling out lines of text that fall between a pair of bracketing lines. When there is no closing bracket, as when an experiment is aborted, a warning is raised and the partial frame is skipped.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="co"># Experiment aborted on trial 3</span>
<span class="kw">aborted</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FrameList.html">FrameList</a></span>(<span class="fu"><a href="../reference/read_eprime.html">read_eprime</a></span>(<span class="st">"data/MP_Block1_001P00XA1.txt"</span>))
<span class="co">#&gt; Warning in make_ranges(starts, ends, eprime_log): Incomplete Log Frame found on line 72</span>
<span class="co">#&gt;      *** LogFrame Start ***</span>
<span class="co">#&gt;      TrialList: 3</span>
<span class="co">#&gt;      Procedure: TrialProcedure</span>
<span class="co">#&gt;      ImageL: marmoset1</span>
<span class="co">#&gt;      ImageR: girl1</span>
<span class="co">#&gt;      Carrier: fin</span>
<span class="co">#&gt;      Target: ImageR</span>
<span class="co">#&gt;      AudioStim: AAE_Fin_girl_312_10</span>
<span class="co">#&gt;      Attention: AAE_check2_10</span>
<span class="co">#&gt;      CarrierDur: 1858</span>
<span class="co">#&gt;      AttentionDur: 914</span>
</pre></div>
<p>The low-level function for chunking the lines of text is <code>extract_chunks</code>. During the chunking, some metadata is inserted into the frames as additional <code>Key: Value</code> lines. These fields are:</p>
<ol style="list-style-type: decimal">
<li>
<code>Eprime.FrameNumber</code>, the number of the log frame in the file</li>
<li>
<code>Eprime.Basename</code>, the <code>basename</code> of the source file</li>
<li>The header frame also gets the lines <code>Procedure: Header</code> and <code>Running: Header</code>.</li>
</ol>
<p>The result of chunking is a list of character vectors. Here’s how the second frame looks after chunking.</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="kw">chunks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_chunks.html">extract_chunks</a></span>(<span class="kw">exp_lines</span>)
<span class="kw">chunks</span>[[<span class="fl">2</span>]]
<span class="co">#&gt;  [1] "\t*** LogFrame Start ***"         "\tProcedure: FamTask"            </span>
<span class="co">#&gt;  [3] "\titem1: bear"                    "\titem2: chair"                  </span>
<span class="co">#&gt;  [5] "\tCorrectResponse: bear"          "\tImageSide: Left"               </span>
<span class="co">#&gt;  [7] "\tDuration: 885"                  "\tFamiliarization: 1"            </span>
<span class="co">#&gt;  [9] "\tFamInforcer: 1"                 "\tReinforcerImage: Bicycle1"     </span>
<span class="co">#&gt; [11] "\tFamiliarization.Cycle: 1"       "\tFamiliarization.Sample: 1"     </span>
<span class="co">#&gt; [13] "\tRunning: Familiarization"       "\tFamTarget.RESP: "              </span>
<span class="co">#&gt; [15] "\tCorrect: True"                  "Eprime.FrameNumber: 2"          </span>
<span class="co">#&gt; [17] "Eprime.Basename: MINP_001L00XS1" "\t*** LogFrame End ***"          </span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "EprimeChunk" "character"</span>
</pre></div>
</div>
<div id="building-lists-from-key-value-strings" class="section level3">
<h3 class="hasAnchor">
<a href="#building-lists-from-key-value-strings" class="anchor"></a>Building lists from “Key: Value” strings</h3>
<p>The data from each log-frame have been stored as character vector in a list. Next, we convert each vector of <code>"Key: Value"</code> strings into a list of named elements. <code>EprimeFrame</code> carries out this task.</p>
<p>During this stage, the special fields (noted above) are parsed. The original form of the special fields is:</p>
<pre><code>   Running: [Key]
   [Key]: [Value]
   [Key].Cycle: [Cycle]
   [Key].Sample: [Sample]</code></pre>
<p>These <code>[Key]</code> values make it harder to merge together data-frames later on, since each unique <code>[Key]</code> gets its own column name. Therefore, we normalize these fields like so:</p>
<ol style="list-style-type: decimal">
<li>
<code>[Key]: [Value]</code> line is deleted and stored in the <code>Eprime.LevelName</code> field instead as <code>"[Key]_[Value]"</code>.</li>
<li>
<code>[Key].Sample</code> and <code>[Key].Cycle</code> are renamed to just <code>Cycle</code> and <code>Sample</code>.</li>
</ol>
<p>One additional field is added, <code>Eprime.Level</code>, to record the depth of nesting (equal to the number of tabs plus one).</p>
<p>Here is how the second frame appears after this stage of parsing:</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="fu"><a href="../reference/EprimeFrame.html">EprimeFrame</a></span>(<span class="kw">chunks</span>[[<span class="fl">2</span>]])
<span class="co">#&gt; List of 17</span>
<span class="co">#&gt;  $ Eprime.Level      : num 2</span>
<span class="co">#&gt;  $ Eprime.LevelName  : chr "Familiarization_1"</span>
<span class="co">#&gt;  $ Eprime.Basename   : chr "MINP_001L00XS1"</span>
<span class="co">#&gt;  $ Eprime.FrameNumber: chr "2"</span>
<span class="co">#&gt;  $ Procedure         : chr "FamTask"</span>
<span class="co">#&gt;  $ Running           : chr "Familiarization"</span>
<span class="co">#&gt;  $ item1             : chr "bear"</span>
<span class="co">#&gt;  $ item2             : chr "chair"</span>
<span class="co">#&gt;  $ CorrectResponse   : chr "bear"</span>
<span class="co">#&gt;  $ ImageSide         : chr "Left"</span>
<span class="co">#&gt;  $ Duration          : chr "885"</span>
<span class="co">#&gt;  $ FamInforcer       : chr "1"</span>
<span class="co">#&gt;  $ ReinforcerImage   : chr "Bicycle1"</span>
<span class="co">#&gt;  $ Cycle             : chr "1"</span>
<span class="co">#&gt;  $ Sample            : chr "1"</span>
<span class="co">#&gt;  $ FamTarget.RESP    : chr ""</span>
<span class="co">#&gt;  $ Correct           : chr "True"</span>
<span class="co">#&gt;  - attr(*, "class")= chr [1:2] "EprimeFrame" "list"</span>
</pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Tristan Mahr.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
